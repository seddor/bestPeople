{% extends 'base.html.twig' %}

{% block body %}

    <div class="container">
        <div class="media">
            <div class="media-left">
                {% if user.avatar is not empty %}
                    <img class="media-object" src={{ user.avatar.webPatch }}>
                {% else %}
                    <img class="media-object" src={{ asset('images/avatar.png') }}>
                {% endif %}
            </div>
            <div class="media-body">
                <h4 class="media-heading">{{ user.username }}</h4>
                <div id="karma">{{ user.karma }}</div>
                {% if is_granted('ROLE_USER') %}
                {% if app.user.username != user.username %}
                <div class="btn-group" role="group">
                    <button id="add-down" type="button" class="btn btn-default">-</button>
                    <button id="add-up" type="button" class="btn btn-default">+</button>
                </div>
                {% else %}
                    <button type="button" class="btn btn-default">Изменить информацию о себе</button>
                {% endif %}
                {% endif %}
            </div>
        </div>
        <div class="container">
            <h4>История</h4>
            {% for history in user.histories %}
                {% if history.user.gender == 'male' %}
                    {% if history.action == true %}
                        <div class="alert alert-success" role="alert"> {{ history.date|date("d.m.Y") }}
                            <a href={{ path('userPage',{'id':history.author.id}) }}>{{  history.author.username }}</a> поставил +</div>
                    {% else %}
                        <div class="alert alert-danger" role="alert"> {{ history.date|date("d.m.Y") }}
                            <a href={{ path('userPage',{'id':history.author.id}) }}>{{  history.author.username }}</a> поставил -</div>
                    {% endif %}
                {% else %}
                    {% if history.action == true %}
                        <div class="alert alert-success" role="alert"> {{ history.date|date("d.m.Y") }}
                            <a href={{ path('userPage',{'id':history.author.id}) }}>{{  history.author.username }}</a> поставила +</div>
                    {% else %}
                        <div class="alert alert-danger" role="alert"> {{ history.date|date("d.m.Y") }}
                            <a href={{ path('userPage',{'id':history.author.id}) }}>{{  history.author.username }}</a> поставила -</div>
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div>
        <div class="container">
            <h4>Комментарии</h4>
            {% for comment in user.coments %}
            <div class="container">
                <div class="well">{{ comment.text }}</div>
                <p><a href={{ path('userPage',{'id':comment.author.id}) }}>{{ comment.author.username }}</a> {{ comment.date|date("d.m.Y") }}</p>
            </div>
            {% endfor %}
            {% if is_granted('ROLE_USER') %}
            <div class="container">
                <h4>Оставить комментарий</h4>
                <form name="commentForm" method="post" action={{ path('commentFormAction',{'id':user.id}) }} }>
                    <textarea name="_comment"></textarea>
                    <button type="submit" class="btn btn-default">Написать</button>
                </form>

            </div>
            {% endif %}
        </div>
    </div>

    <script type="text/javascript">

        {% if complete is not empty %}
            {% if complete.action == true %}
                disableButton();
                $('#add-up').addClass('btn-success');
            {% else %}
                disableButton();
                $('#add-down').addClass('btn-danger');
            {% endif %}
        {% endif %}

        $('#add-up').click(function (){
                    $.ajax({
                        url: '{{ path('updateKarma') }}',
                        beforeSend: function(){
                            $('#karma').html('<img class="media-object" src={{ asset('images/ajax-loader.gif') }}>');
                        },
                        data: {id: {{ user.id}},action:'up'},
                        success: function(data){
                            var obj = $.parseJSON(data);
                            $('#karma').html(obj.karma);
                            disableButton();
                            $('#add-up').addClass('btn-success');
                        }
                    })
                }
        );
        $('#add-down').click(function (){
                    $.ajax({
                        url: '{{ path('updateKarma') }}',
                        data: {id: {{ user.id}},action:'down'},
                        success: function(data){
                            var obj = $.parseJSON(data);
                            $('#karma').html(obj.karma);
                            disableButton();
                            $('#add-down').addClass('btn-danger');
                        }
                    })
                }
        )

        function disableButton() {
            $('#add-down').attr('disabled','disabled');
            $('#add-up').attr('disabled','disabled');
        }



    </script>

{% endblock %}